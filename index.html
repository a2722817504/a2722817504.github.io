
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>播放器</title>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-3.3.1.js"></script>
<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script>
$(function(){ 
	var num,last_num1,last_num2,last_num3,last_num4,current_num,current_class,change=0;
	var audio = $("#play");
	
	$("#but1").click(function() {  
		$("#player").show();
		do{
			num = get_random_val();
		} while(num==last_num1);
		$("#change").attr("src","pause.jpg");
		
		$("#now").text("1_"+num);
		
		audio.get(0).pause();	
		audio.attr("src","music1_"+num+".mp3"); 
		audio.get(0).play();	
		last_num1 = num;
		current_num = num;
		current_class = 1;
		change = 0;
	});
	$("#but2").click(function() { 
		$("#player").show();
		do{
			num = get_random_val();
		} while(num==last_num2);
		$("#change").attr("src","pause.jpg");
		
		$("#now").text("2_"+num);
		
		audio.get(0).pause();	
		audio.attr("src","music2_"+num+".mp3"); 
		audio.get(0).play();
		last_num2 = num;	
		current_num = num;
		current_class = 2;
		change = 0;
	});
	$("#but3").click(function() {  
		$("#player").show();
		do{
			num = get_random_val();
		} while(num==last_num3);
		$("#change").attr("src","pause.jpg");
		
		$("#now").text("3_"+num);
		
		audio.get(0).pause();	
		audio.attr("src","music3_"+num+".mp3"); 
		audio.get(0).play();	
		last_num3 = num;
		current_num = num;
		current_class = 3;
		change = 0;
	});
	$("#but4").click(function() {
		$("#player").show();
		do{
			num = get_random_val();
		} while(num==last_num4);
		$("#change").attr("src","pause.jpg");
		
		$("#now").text("4_"+num);
		
		audio.get(0).pause();	
		audio.attr("src","music4_"+num+".mp3"); 
		audio.get(0).play();
		last_num4 = num;
		current_num = num;	
		current_class = 4;
		change = 0;
	});
	
	function get_random_val(){
		var val;
		val = Math.floor((Math.random() * 5) + 1);
		
		return val;
	}
	
    audio.bind("ended", function() { 
		do{
			num = get_random_val();
		} while(num==current_num);
		$("#change").attr("src","pause.jpg");
		
		$("#now").text(current_class+"_"+num);
		
    	audio.currentTime = 0;
		audio.attr("src","music"+current_class+"_"+num+".mp3"); 
		audio.get(0).play();
		current_num = num;	
		change = 0;
    });
    
	$("#but_switch").click(function() {
		if(change==0)
		{
			$("#change").attr("src","play.jpg");
			audio.get(0).pause();	
			change = 1;
		}
			
		else
		{
			$("#change").attr("src","pause.jpg");
			audio.get(0).play();	
			change = 0;
		}
	});

	audio.on('timeupdate', function() {
		var ltime_cur = parseInt(audio[0].currentTime);
		var lmm_cur = parseInt(ltime_cur/60);
  		var lss_cur = ltime_cur - lmm_cur*60;
   		$('.current').text((lmm_cur<10?"0":"")+lmm_cur+":"+(lss_cur<10?"0":"")+lss_cur+"/");

   		var currentPos = audio[0].currentTime; //Get currenttime
   		var maxduration = audio[0].duration; //Get video duration
   		var percentage = 100 * currentPos / maxduration; //in %
   		$('.timeBar').css('width', percentage+'%');

  	});

	audio.on('loadedmetadata', function() {
		var ltime = parseInt(audio[0].duration);
		var lmm = parseInt(ltime/60);
  		var lss = ltime - lmm*60;
   		$('.duration').text((lmm<10?"0":"")+lmm+":"+(lss<10?"0":"")+lss);
	});

	var timeDrag = false;   /* Drag status */
	$('.progressBar').mousedown(function(e) {
   		timeDrag = true;
   		updatebar(e.pageX);
	});
	
	$(document).mouseup(function(e) {
   		if(timeDrag) {
      		timeDrag = false;
      		updatebar(e.pageX);
   		}
	});
	
	$(document).mousemove(function(e) {
	   if(timeDrag) {
	      updatebar(e.pageX);
	   }
	});

	var updatebar = function(x) {
   		var progress = $('.progressBar');
   		var maxduration = audio[0].duration; //Video duraiton
   		var position = x - progress.offset().left; //Click pos
   		var percentage = 100 * position / progress.width();
 	
   		//Check within range
   		if(percentage > 100) {
   		   percentage = 100;
   		}
   		if(percentage < 0) {
   		   percentage = 0;
   		}
 
		   //Update progress bar and video currenttime
	    $('.timeBar').css('width', percentage+'%');
	    audio[0].currentTime = maxduration * percentage / 100;
};


});
</script>

<style type="text/css">
.position_player {
	margin-left: 250px;
	margin-top: 50px;
	margin-bottom: 50px;
	background-color:silver;
}

.progressBar
{
   position: relative;
   width: 300px;
   height: 75px;
   background-color: #000000;
}
.timeBar
{
   position: absolute;
   top: 28px;
   left: 0;
   width: 0;
   height: 20px;
   background-color: #ff0000;
}

</style>

</head>

<body>
	<button id="but1" type="button" style="width: 80px; height: 80px; background-color: #660000;">
		<img src="color1.png">
	</button>&nbsp;
	<button id="but2" type="button" style="width: 80px; height: 80px; background-color: #888800;">
		<img src="color2.png">
	</button>&nbsp;
	<button id="but3" type="button" style="width: 80px; height: 80px; background-color: #006600;">
		<img src="color3.png">
	</button>&nbsp;
	<button id="but4" type="button" style="width: 80px; height: 80px; background-color: #0000CC;">
		<img src="color4.png">
	</button>
	
	<br><br><br>
	
	<div id="player" class="position_player" style="width: 500px; height: 300px;display: none;"><!-- display: none;-->
		<br>&nbsp;&nbsp;
		<button id="but_switch" style="width: 80px; height: 80px; background-color: #222222;" type="button">
			<img id="change" src="pause.jpg">
		</button>&nbsp;&nbsp;

  		<div class="progressBar" style="left: 100px; top: -80px">
   			<div class="timeBar"></div>
		</div>&nbsp;&nbsp;	
		
   		<span class="current"></span>
  		<span class="duration"></span>
  		


		
	</div>
	
	
	<p>-----------以下是幫助你判斷-----------</p>	
	<audio id="play" controls="controls" src="music1_1.mp3" ></audio>
	<p>現在正在播<div id="now"></div></p>
	
</body>
</html>
